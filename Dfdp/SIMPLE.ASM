	IDT	'SIMPLE'
	REF	FIIR,IIIR	*These are the two symbols that
*				*are defined in the code generated
*				*by CGEN
*
	DEF	FILTT,VIIR	*These symbols are referrenced by
*				*code generated by CGEN
*
*
* Define the locations in the direct page
*
IOPAGE	EQU	0	* Use direct page 0
*
* Direct page zero starts at location 96
*
VIIR	EQU	96		*INPUT SAMPLE TO FILTER SUBROUTINE
*				* and OUTPUT SAMPLE FROM SUBROUTINE
*
FILTT	EQU	97		*TEMPORARY USED BY IIR FILTER SUBROUTINE
*
DOUT	EQU	6		*D/A OUTPUT
DIN	EQU	6		*A/D INPUT
*
*************************************************
*                                               *
*                SIMPLE EXAMPLE                 *
*                Low Pass Filter                *
*                                               *
*  This example assumes that an A/D and a D/A   *
*  are addressed at I/O location 6 (i.e. when   *
*  the 320 reads I/O location 6 it reads the    *
*  data from the A/D and when it writes I/O     *
*  location 6 it writes data to the D/A).  It   *
*  also assumes that a sample clock is starting *
*  the A/D and the end of convert signal sets a *
*  flip-flop and that the output of the flip-   *
*  is connected to the BIO pin on the TMS320.   *
*  This flip-flop is cleared by a read from I/O *
*  location 6.                                  *
*                                               *
*************************************************
	PSEG
	B	START
	BSS	30
START
************************************************
*                MAIN I/O LOOP                 *
************************************************
*
*INITIALIZE THE TMS32020
*
	LDPK	IOPAGE		*Set up the I/O direct page
	SPM	1		*Product Output shift = 1 bit
	SSXM			*Set Sign Extend Mode ON
	SOVM			*Set Overflow Arith. ON
*
*INITIALIZE THE FILTER
	CALL	IIIR
*
*Start of Main I/O Loop
*
IOLOOP
*
* Wait for end of convert.
	BIOZ	GET		*WAIT FOR END OF CONVERT
	B	IOLOOP		*BRANCH IF NOT
*
* Output filtered sample and get new one.
GET	OUT	VIIR,DOUT	*OUTPUT LAST FILTERED SAMPLE
	IN	VIIR,DIN	*INPUT SAMPLE
*
* Filter sample
	CALL	FIIR
* FIIR expects a two's complement digital sample in the PAGE storage
* location VIIR.  FIIR will output the filtered sample into the same
* PAGE storage location VIIR.
*
* Wait for next sample
	B	IOLOOP		*LOOP
*
	PEND
	END
